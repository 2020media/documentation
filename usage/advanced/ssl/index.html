<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>SSL - Aegir Hosting System</title>
  

  <link rel="shortcut icon" href="../../../_images/favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/highlight.css">
  <link href="../../../_css/toc.css" rel="stylesheet">
  <link href="../../../_css/menu.css" rel="stylesheet">
  <link href="../../../_css/images.css" rel="stylesheet">
  <link href="../../../_css/style.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "SSL";
    var mkdocs_page_input_path = "usage/advanced/ssl.md";
    var mkdocs_page_url = "/usage/advanced/ssl/";
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js"></script>
  <script src="../../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../../js/highlight.pack.js"></script>
  <script src="../../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> Aegir Hosting System</a>
        <div role="search">
  <form id ="rtd-search-form-alt" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../quick-start/">Quick start</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../install/">Install</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Install</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../install/upgrade/">Upgrade</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../install/uninstall/">Uninstall</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../">Using Aegir</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Using Aegir</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../verify/">Verifying servers, platforms and sites</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../sites/">Sites</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Sites</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../sites/tasks/">Site tasks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../sites/aliases/">Site aliases</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../sites/importing/">Importing sites</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../platforms/">Platforms</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Platforms</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../platforms/tasks/">Platform tasks</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../">Advanced features</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Advanced features</span></li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">SSL</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#using-ssl">Using SSL</a></li>
                
                    <li><a class="toctree-l4" href="#prepare-your-server">Prepare your server</a></li>
                
                    <li><a class="toctree-l4" href="#enable-ssl-support-in-aegir">Enable SSL support in Aegir</a></li>
                
                    <li><a class="toctree-l4" href="#configure-a-web-server">Configure a web server</a></li>
                
                    <li><a class="toctree-l4" href="#configure-a-site">Configure a site</a></li>
                
                    <li><a class="toctree-l4" href="#commercial-certificates">Commercial Certificates</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../remote-servers/">Multiple servers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../clients/">Access control</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../provisionacl/">ProvisionACL</a>
        
    </li>

        
    </ul>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../extend/">Extending Aegir</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Extending Aegir</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../extend/terminology/">Design and terminology</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../extend/architecture/">Architecture</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../extend/provision/">Provision</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Provision</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../extend/provision/contexts/">Contexts</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../extend/frontend/">Frontend</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../extend/altering-behaviours/">Altering behaviours</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../extend/contrib/">Contributed projects</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../help/contact/">Help</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../community/">Community</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Community</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../community/code-of-conduct/">Code of Conduct</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../community/core-team/">Core team</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Core team</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../community/core-team/criteria/">Criteria</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../community/core-team/leadership/">Leadership</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../community/core-team/welcome/">Welcoming a new member</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../community/release-process/">Release process</a>
        
    </li>

        
            
    <ul class="subnav">
    <li><span>Release process</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../community/release-process/debian-packaging/">Debian packaging</a>
        
    </li>

        
    </ul>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../community/resources/">Resources</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../release-notes/3.4/">Release notes</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Release notes</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../release-notes/3.0/">3.0</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../release-notes/3.1/">3.1</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../release-notes/3.2/">3.2</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../release-notes/3.3/">3.3</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../release-notes/3.4/">3.4</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../release-notes/3.5/">3.5</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../release-notes/3.6/">3.6</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">Aegir Hosting System</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>Using Aegir &raquo;</li>
        
      
        
          <li>Advanced features &raquo;</li>
        
      
    
    <li>SSL</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/aegir-project/documentation" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="using-ssl">Using SSL</h1>
<div class="toc">
<ul>
<li><a href="#using-ssl">Using SSL</a><ul>
<li><a href="#prepare-your-server">Prepare your server</a><ul>
<li><a href="#open-ssl-port">Open SSL port</a></li>
<li><a href="#install-ssl">Install SSL</a></li>
<li><a href="#enable-ssl">Enable SSL</a></li>
</ul>
</li>
<li><a href="#enable-ssl-support-in-aegir">Enable SSL support in Aegir</a></li>
<li><a href="#configure-a-web-server">Configure a web server</a></li>
<li><a href="#configure-a-site">Configure a site</a></li>
<li><a href="#commercial-certificates">Commercial Certificates</a><ul>
<li><a href="#nginx">Nginx</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>SSL support was significantly improved in Aegir 3.0 and subsequent releases have further refined the SSL functionality. Aegir now supports SNI by default, making assignment of IP addresses unnecessary.</p>
<p>Here are the current steps to configure SSL support in Aegir and apply it to your web sites.</p>
<h2 id="prepare-your-server">Prepare your server</h2>
<h3 id="open-ssl-port">Open SSL port</h3>
<p>Make sure port 443 is open for SSL traffic. That is, ensure no firewall rules or other configuration is blocking traffic to port 443.</p>
<h3 id="install-ssl">Install SSL</h3>
<p>From the command line, install SSL software for your web server. On Debian/Ubuntu you can use:</p>
<pre><code># apt-get install openssl
</code></pre>
<h3 id="enable-ssl">Enable SSL</h3>
<p>Enable SSL support and restart your webserver at this point.</p>
<pre><code># a2enmod ssl
# service apache2 restart
</code></pre>
<h2 id="enable-ssl-support-in-aegir">Enable SSL support in Aegir</h2>
<p>You have to enable SSL support in Aegir as it is off by default.</p>
<ol>
<li>Visit /admin/hosting/features to get to the Aegir features page.
<img alt="Hosting Features menu link" src="../../../_images/hosting-features.png" /></li>
<li>Click on Experimental to reveal experimental features experimental features of Aegir
<img alt="SSL Support feature" src="../../../_images/ssl-support-feature.png" /></li>
<li>Check SSL support</li>
<li>Click Save configuration</li>
</ol>
<h2 id="configure-a-web-server">Configure a web server</h2>
<p>You next need to enable SSL on a web server.</p>
<ol>
<li>Click on the Servers tab</li>
<li>Click on the server for which you wish to enable SSL support</li>
<li>Click Edit to change the server configuration</li>
<li>(Optional, but highly recommended) Remove any IP addresses assigned to the server. This will activate SNI, which is supported in all modern browsers.</li>
<li>Click apache_ssl. This will reveal an additional field: SSL port, which should be already populated with 443.
<img alt="Enable SSL on server" src="../../../_images/enable-ssl-on-server.png" /></li>
<li>Click Save. This will trigger a verify task on the server followed by verify tasks on all platforms that are associated with that server.</li>
</ol>
<p>If all goes well you will see the following changes in your Aegir file system structure: a new <code>/var/aegir/config/ssl.d</code> directory and a new <code>/var/aegir/config/server_master/ssl.d</code> directory. The <code>/var/aegir/config/ssl.d</code> directory is where you will be able to manipulate SSL keys and certificates, for example by importing commercial SSL certificates or generating a new key. Do not manually edit the <code>/var/aegir/config/server_master/ssl.d</code> directory as changes to that directory will be overwritten when the server or site are verified.</p>
<h2 id="configure-a-site">Configure a site</h2>
<p>You can now finally enable SSL on any sites that are installed on any platforms associated with the server where we enabled SSL.</p>
<ol>
<li>Browse to hosting/c/example.com</li>
<li>Click Edit to change the site configuration</li>
<li>Choose the type of Encryption required and the Encryption key (see the explanatory notes below each option). <em>NOTE:</em> Alternatively, you may specify a directory under <code>/var/aegir/config/server_master/ssl.d</code> where your own certificate and key is to be stored (see Commercial certificate notes below).
<img alt="Site SSL configuration" src="../../../_images/site-ssl-configuration.png" /></li>
<li>Click Save.</li>
</ol>
<p>Aegir will then generate a certificate and private key for your web site and insert these into a new VirtualHost directive in your vhost file. (This file is typically at <code>/config/server_master/apache/vhost.d/example.com</code>). If all goes well the VirtualHost directive will now have these important elements:</p>
<pre><code>&lt;VirtualHost *:443&gt;
    ....

    # Enable SSL handling.
    SSLEngine on

    SSLCertificateFile /var/aegir/config/server_master/ssl.d/example.com/openssl.crt
    SSLCertificateKeyFile /var/aegir/config/server_master/ssl.d/example.com/openssl.key
</code></pre>
<p>Now, when you navigate to https://example.com you should see that your site is SSL enabled. It will, however, generate warnings in your browsers because it is a self-signed certificates. See below for how to use commercial certificates to remove this warning.</p>
<h2 id="commercial-certificates">Commercial Certificates</h2>
<p>If you wish to use your own commercial certificate and key you will need to do the following:</p>
<ol>
<li>Follow the directions above, using the "Generate new encryption key" option and using your site's domain name for the "New encryption key". This will create a site directory under <code>/var/aegir/config/ssl.d/example.com</code>. With this step, you have created a self-signed certificate, and your site is now configured to use it.</li>
<li>This generated a 2048 bit RSA key for you along with a CSR (Certificate Signing Request). If you prefer to generate your own RSA key, replace the files (<code>openssl.key</code> and <code>openssl.csr</code>) in the <code>/var/aegir/config/ssl.d/example.com</code> directory with your RSA key and associated CSR.</li>
<li>Copy and paste the .csr file into the form for the issuing Certificate Authority (CA) to create your certificate. When your certificate has been generated, download the files from the issuing authority and place in your temporary folder on your PC. You may have more than one .crt files, in this case you have a "bundle" or what we call a "certificate chain" that you need to add in aegir (see below).</li>
<li>Transfer all the files to <code>/var/aegir/config/ssl.d/example.com</code>. Rename the site .crt file to <code>openssl.crt</code>. If you have a certificate chain, install it in <code>openssl_chain.crt</code>. You should have at least three files in the directory (<code>openssl.crt</code>, <code>openssl.key</code>, <code>openssl.csr</code>, and optionnally <code>openssl_chain.crt</code>).</li>
<li>Verify your site from Aegir's frontend.</li>
</ol>
<p>You should now be able to access your site via https:// using your commercial certificate.</p>
<h3 id="nginx">Nginx</h3>
<p>It is recommended to allow Aegir to create a default self-signed certificate and key first, and then replace the contents of both files (not the files itself) with your real key and certificate. Any chained certificates (bundles) should be included in the same file, directly below your own certificate - there is no need for extra files/lines like it is for Apache configuration.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../remote-servers/" class="btn btn-neutral float-right" title="Multiple servers">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../" class="btn btn-neutral" title="Advanced features"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/aegir-project/documentation" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../remote-servers/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
